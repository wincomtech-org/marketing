{include file="inc/head.tpl"}
<style type="text/css">
    {literal}
    .clear{display:block;content:"";clear:both;}
    .regist #mobile{width:96%;}
    #code{width:61.5%;float:left;}
    .getCode{width:129px;display:block;float:left;height:42.5px;line-height:42.5px;text-align:center;color:#f00;}
    .getCode img{display:block;width:100px;margin:5px auto;}
    .msg_tag{font-size: 1.25em;width: 96%;line-height: 150%;padding: 3% 0 3% 3.4%;margin-bottom: 4%;}
    {/literal}
</style>

<body class="login-bg">
    <div class="header" style="background-color:#fff;padding:1rem 0.5rem">
        <div class="nav">
            <a href="{$site.root_url}" class="logo"><img src="sys/{$site.site_logo}"alt="{$site.site_name}" title="{$site.site_name}"/></a>
        </div>
    </div>
    <div class="login regist">
        <div class="login-from">
            <div class="login-input">
            <form action="{$url.password_reset_post}" method="post" id="password_reset">
                <div class="login-tit">找回密码</div>

                <input id="mobile" type="text" placeholder="输入手机号"/>

                <input id="code" type="text" placeholder="输入验证码" onkeyup="code_keyup()">
                <a class="getCode" onclick="refreshimage()"><img src="captcha.php" id="vcode"></a>
                <!-- <a class="getCode" onclick="ajax_picYZ()"><img src="images/captcha.jpg" id="popup-sublimt"></a> -->

                <i class="clear"></i>
                <p id="msg_tag"></p>

                <input id="password1" type="password" name="pwd1" placeholder="请输入密码"/>
                <input id="password2" type="password" name="pwd1" placeholder="请确认密码"/>

                <input type="submit" value="重置密码" style="background:#ff5454;"/>
                <div class="login-b"><span></span><a href="javascript:history.back(-1);">返回</a></div>
            </form>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
// alert(url)
    {literal}
    function code_keyup(){
        var pic_yz=$("#code").val();
        var mobile = $("#mobile").val();
        if($("#code").val().length==4){
            if(!(/^1(3|4|5|7|8)\d{9}$/.test(mobile))){
                $('#msg_tag').css('color','#F00').addClass('msg_tag').html('手机号码不正确！');
                return false; 
            }
            $.ajax({
                url:url,
                type:"post",
                dataType:'json',
                data:{
                    imgCode:pic_yz,
                    mobile:mobile
                },
                success:function(e){
                    console.log(e);
                    if(e.code==1){
                        $("#code").val('')
                        $('.getCode').attr('onclick','');
                        $("#code").attr("onkeyup",'').attr('placeholder',"请填写短信验证码");
                        settime(60);
                        $('#msg_tag').css('color', '#61CE3C').addClass('msg_tag').html(e.msg);
                    }else{
                        $('.getCode').html('<img src="captcha.php" id="vcode">');
                        refreshimage();
                        $("#code").attr({
                            placeholder: '请输入验证码',
                            onkeyup: "code_keyup()"
                        }).val('');
                        $('#msg_tag').css('color', '#F00').addClass('msg_tag').html(e.msg);
                    }
                }
            })
        }
    }
    function settime(countdown){
        if (countdown == 0) {
            $('.getCode').html('<img src="captcha.php" id="vcode">');
            refreshimage();
            $("#code").attr({
                placeholder: '重新操作',
                onkeyup: "code_keyup()"
            });
            return false;
        }else{
            $('.getCode').html(countdown+'s 后可重新操作');
            countdown--;
        }
        setTimeout(function() {
            settime(countdown);
        },1000)
    }
    // 换验证码，不用这个
    function ajax_picYZ(){
        $.ajax({
            url:"/user/img.shtml",
            type:"post",
            success:function(e){
                var data=new Date();
                $('#popup-sublimt').attr('src',url+"/user/img.shtml?"+data.getTime())
            }
        })
    }
    {/literal}
</script>
</html>
