{include file="inc/head.tpl"}
<link rel="stylesheet" href="{$site.theme_s}resetCss/header.css"/>
<style>
{literal}
    .clear{display:block;content:"";clear:both;}
    .regist #mobile{width:96%;}
    #code{width:49.5%;float:left;}
    .getCode{width:124px;display:block;float:left;height:42.5px;line-height:42.5px;text-align:center;color:#f00;}
    .getCode img{display:block;width:100px;margin:5px auto;}
    .header .nav{padding:0.5rem;}
    .header .nav img{width:20%;}
{/literal}
</style>

<body class="login-bg">

<div class="header" style="background-color:#fff;">
    <div class="nav">
        <!-- <a href="{$site.root_url}" class="logo"><img src="sys/{$site.site_logo}" alt="{$site.site_name}"/></a> -->
    </div>
</div>
<div class="login regist">
    <div class="login-from">
        <div class="login-input">
        <form action="{$url.password_reset_post}" method="post" id="password_reset">
            <div class="login-tit">找回密码</div>
            <input type="text" name="telephone" id="mobile" placeholder="输入手机号"/>

            <input type="text" name="msgcode" id="code" placeholder="输入验证码"/ onkeyup="code_keyup()">
            <a class="getCode" onclick="ajax_picYZ()"><img src="img.shtml.jpg" id="popup-sublimt"></a>

            <i class="clear"></i>
            <p id="msg_tag"></p>

            <input type="password" name="password" id="password1" placeholder="请输入密码"/>
            <input type="password" name="password2" id="password2" placeholder="请确认密码"/>

            <input type="hidden" name="token" value="{$token}" />
            <input id="status" type="hidden" value="3">
            <input type="submit" onclick="resetPass();" value="重置密码" style="background:#ff5454;"/>
            <div class="login-b"><span></span><a href="javascript:history.back(-1);">返回</a></div>
        </form>
        </div>
    </div>
</div>

</body>

<script type="text/javascript" src="{$site.theme_s}js/news.js"></script>
<script>
{literal}
function code_keyup(){
	var pic_yz=$("#code").val();
	var mobile = $("#mobile").val();
	if($("#code").val().length==4){
		if(!(/^1(3|4|5|7|8)\d{9}$/.test(mobile))){ 
            alert("æ‰‹æœºå·ç æœ‰è¯¯ï¼Œè¯·é‡å¡«");  
            return false; 
        }
		$.ajax({
			url:url+"/user/send_code.shtml",
			type:"post",
			data:{
				imgCode:pic_yz,
				mobile:mobile
			},
			success:function(e){
				if(e.code==0){
					$("#code").val('')
					$('.getCode').attr('onclick','');
					$("#code").attr("onkeyup",'').attr('placeholder',"è¯·åœ¨æ­¤è¾“å…¥æ‰‹æœºéªŒè¯ç ");
                    settime(60);
                    alert("å‘é€æˆåŠŸï¼");
                }else{
                	alert(e.message)
                	ajax_picYZ();
        	    	$("#code").attr("placeholder","è¯·å†æ¬¡å¡«å†™å›¾ç‰‡éªŒè¯ç ").attr("onkeyup","code_keyup()").val('');
        	        $('.getCode').html('<img src="http://www.315pr.com/user/img.shtml" id="popup-sublimt">');
        	        $('.getCode').click(function(){
        	            ajax_picYZ();
        	        });
				}
			}
		})
	}
}
function settime(countdown){
    if (countdown == 0) {
    	ajax_picYZ();
    	$("#code").attr("placeholder","è¯·å†æ¬¡å¡«å†™å›¾ç‰‡éªŒè¯ç ").attr("onkeyup","code_keyup()")
        $('.getCode').html('<img src="http://www.315pr.com/user/img.shtml" id="popup-sublimt">');
        $('.getCode').click(function(){
            ajax_picYZ();
        });
        return false;
    }else{
        $('.getCode').html(countdown+'s');
        countdown--;
    }
    setTimeout(function() {
        settime(countdown);
    },1000)
}
function ajax_picYZ(){
	$.ajax({
		url:url+"/user/img.shtml",
		type:"post",
		success:function(e){
			var data=new Date();
			$('#popup-sublimt').attr('src',url+"/user/img.shtml?"+data.getTime())
		}
	})
}
{/literal}
</script>
</html>
