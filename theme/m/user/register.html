{include file="inc/head.tpl"}
<link rel="stylesheet" href="{$site.theme_s}resetCss/header.css"/>
<script src="{$site.theme_s}js/pagination.js"></script>
<style>
{literal}
.checkboxText {
	display: block;
	float: left;
	width: 50%;
	margin-bottom: 20px;
}
{/literal}
</style>

<body class="cover">
{include file="inc/header.tpl"}
<script>
{literal}
    $(document).delegate('.menu_icon','click',function(){
        $(this).siblings('.nav').toggle();
    });
{/literal}
</script>

<div class="login regist m10">
    <div class="login-from">
        <div class="login-input">
        <form id="register" action="{$url.register_post}" method="post">
            <div class="login-tit">账户注册</div>
            <input type="text" name="telephone" id="mobile" placeholder="输入手机号" style="margin-top:10px;"/>

            <!--{if $site.captcha}-->
            <div id="popup-submit">发送验证码</div>
            <input type="text" name="msgcode" id="code" placeholder="输入手机验证码"/>
            <input id="status" type="hidden" value="2">
            <p id="msg_tag"></p>
            <!--{/if}-->

            <input type="password" name="password" id="password1" placeholder="新密码"/>
            <input type="password" name="password_confirm" id="password2" placeholder="重复密码"/>

            <div class="login-a loginProtocol">
                <input style="float:left;margin-top:2px;margin-right:3px;" type="checkbox"/> 
                <label style="font-size:12px;float:left;">我已阅读并同意</label> 
                <a style="font-size:12px;float:left;" href="lawyer.php?law=provisions">《服务条款》</a>
                <a style="font-size:12px;float:left;" href="lawyer.php?law=disclaimer">《法律公告及免责声明》</a> 
                <a style="font-size:12px;float:left;" href="lawyer.php?law=protocol">《保密协议书》</a>
            </div>

            <input type="hidden" name="token" value="{$token}" />
            <input type="submit" onclick="register();" value="注册"/>
            <div class="login-b"><span>已注册账号？</span><a href="{$url.login}">登录</a></div>
        </form>
        </div>
    </div>
     <div id="popup-captcha"></div>
</div>
</body>
<script src="http://static.geetest.com/static/tools/gt.js"></script>
<script>
{literal}
    var handlerPopup = function (captchaObj) {
        $("#popup-submit").click(function () {
            var validate = captchaObj.getValidate();
            if (!validate) {
                alert('请先完成验证！');
                return;
            }
            var mobile = $("#mobile").val();
            $.ajax({
                url: url + "/user/send_code.shtml", // 进行二次验证
                type: "post",
                dataType: "json",
                data: {
                    // 二次验证所需的三个值
                     "v": "2.0",
                    "source": 2,
                    "mobile": mobile,
                    geetest_challenge: validate.geetest_challenge,
                    geetest_validate: validate.geetest_validate,
                    geetest_seccode: validate.geetest_seccode
                },
                success: function (data) {
                     if('0' == data.code){
                         $('button').attr('onclick','');
                         settime(60);
                         alert("发送成功！");
                     }else{
                         alert(data.message);
                     }
                }
            });
        });
        // 弹出式需要绑定触发验证码弹出按钮
        captchaObj.bindOn("#popup-submit");
        // 将验证码加到id为captcha的元素里
        captchaObj.appendTo("#popup-captcha");
        // 更多接口参考：http://www.geetest.com/install/sections/idx-client-sdk.html
    };

    $.ajax({
        // 获取id，challenge，success（是否启用failback）
        url: url + "/startcaptcha/start.shtml",
        type: "get",
        dataType: "json",
        success: function (data) {
            // 使用initGeetest接口
            // 参数1：配置参数
            // 参数2：回调，回调的第一个参数验证码对象，之后可以使用它做appendTo之类的事件
            initGeetest({
                gt: data.gt,
                challenge: data.challenge,
                product: "popup", // 产品形式，包括：float，embed，popup。注意只对PC版验证码有效
                offline: !data.success // 表示用户后台检测极验服务器是否宕机，一般不需要关注
            }, handlerPopup);
        }
    });
{/literal}
</script>
</html>